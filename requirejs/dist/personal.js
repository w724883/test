require(["zepto","serialize","ui","../common","area","lazyload"],function(e,t,n,r,i){var s={init:function(){this.$changePassword=e("#changePassword"),this.$addAddress=e("#addAddress"),this.$editAddress=e("#editAddress"),this.$listAddress=e("#listAddress"),this.$my=e("#my"),this.$showMy=e("#showMy"),this.region=e.parseJSON(e("#region").html()),this.bindEvent(),r.init(),r.bindSelect()},bindEvent:function(){s.$listAddress.on("tap",".J-default",function(t){return e(this).find(".icon-infok").length||s.setDefaultAddress(e(this).closest(".info-section")),!1}),s.$listAddress.on("tap",".J-delete",function(t){var r=e(this);n.confirm("您确定要删除？",function(e){e&&s.deleteAddress(r.closest(".info-section"))})}),r.bindSelect(),this.$changePassword.on("tap",".btn",function(e){var n=t.init(s.$changePassword);s.changePassword(n)}),this.$addAddress.on("tap",".btn",function(e){var n=t.init(s.$addAddress);s.createAddress(n)}),this.$editAddress.on("tap",".btn",function(e){var n=t.init(s.$editAddress);s.editAddress(n)}),this.$my.on("change",".J-upload input[type=file]",function(e){s.uploadFace(this)}),this.$showMy.on("tap",".btn",function(e){var n=t.init(s.$showMy);s.setShowMy(n)}),this.region&&this.selectRegion(this.region)},setDefaultAddress:function(t){var r=t.data("id"),i=t.data("uid");e.post("/set_default_address","id="+r+"&user_id="+i,function(e){e.code==200?(t.siblings(".info-section").find(".icon-infok").removeClass("icon-infok"),t.find(".icon-info").addClass("icon-infok")):n.alert(e.message)},"json").fail(function(e){n.alert(e)})},deleteAddress:function(t){var r=t.data("id");e.post("/delete_address","id="+r,function(e){t.fadeOut("400",function(){t.remove(),e.code!=200&&n.alert(e.message)})},"json").fail(function(e){n.alert(e)})},selectRegion:function(t){var r=new i;r.init({trigger:"#txt_area",value:e("#hd_area").val(),data:t,level:4,name:"region_name",callback:function(t){t.find('.focus[ref="0"]').siblings("dd").length&&(n.alert("请补全所在地区"),e("#hd_area").val(""),e("#txt_area").val(""))}})},changePassword:function(t){t.error.length?n.alert(t.error[0].error):e.post("/passwd",t.data,function(e){e.code==200?window.location.href="/login":e.code==201?window.location.href="/my":n.alert(e.message)},"json").fail(function(e){n.alert(e)})},createAddress:function(t){t.error.length?n.alert(t.error[0].error):e.post("/create_address",t.data,function(e){e.code==200?window.location.href="/address":n.alert(e.message)},"json").fail(function(e){n.alert(e)})},editAddress:function(t){t.error.length?n.alert(t.error[0].error):e.post("/execute_edit_address",t.data,function(e){e.code==200?window.location.href="/address":n.alert(e.message)},"json").fail(function(e){n.alert(e)})},uploadFace:function(e){r.upload(e,"/upload_face_edit",{success:function(e){if(e.code==200){var t=s.$my.find(".J-upload");t.find(".icons").length?t.find(".icons").replaceWith('<img class="center" data-original='+e.data+" />"):t.find("img").length&&t.find("img").replaceWith('<img class="center" data-original='+e.data+" />"),t.find(".center").center()}},tips:function(e){n.alert(e)}})},setShowMy:function(t){t.error.length?n.alert(t.error[0].error):e.post("/edit_my",t.data,function(e){e.code==200?window.location.href="/address":n.alert(e.message)},"json").fail(function(e){n.alert(e)})}};s.init()});