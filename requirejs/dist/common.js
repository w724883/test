define(["zepto","serialize","ui","lazyload"],function(e,t,n){var r={init:function(){e(".center").center(),e(".lazy").lazyload({threshold:200,effect:"fadeIn"})},bindSelect:function(){e(".select select").on("change",function(t){e(this).siblings("span").html(e(this).children('option[value="'+e(this).val()+'"]').html())}).trigger("change")},bindSearch:function(){var t="";e("#search").on("focus","input",function(n){e(this).val(t).siblings(".search-placeholder").hide()}).on("blur","input",function(n){t=e(this).val(),e(this).val("").siblings(".search-placeholder").show()})},bindTab:function(){function a(e,n){t.height(t.find(".J-items").eq(e).height()),n?(r.find(".underline").addClass("animation-translate").css("transform","translate3d("+e*100+"%,0,0)"),t.addClass("animation-translate").css("transform","translate3d(-"+e*(100/i)+"%,0,0)")):(r.find(".underline").css("transform","translate3d("+e*100+"%,0,0)"),t.css("transform","translate3d(-"+e*(100/i)+"%,0,0)"))}var t=e("#tabContainer"),r=e("#slideTab"),i=r.find("li:not(.underline)").length,s=r.find("li.active").index(),o=e(window).width();r.find("li").width(100/i+"%"),t.width(o*i).find(".J-items").width(o);var u;a(s),r.on("tap","li",function(r){if(e(this).data("userid")==="")n.modal(e(".pop-login"));else{if(e(this).hasClass("active"))return!1;s=e(this).index(),e(this).addClass("active").siblings(".active").removeClass("active"),a(s,!0),clearTimeout(u),u=setTimeout(function(){t.find(".J-items").eq(s).find(".lazy").lazyload()},800)}})},bindLogin:function(r){var i=t.init(r);i.error.length?n.alert(i.error[0].error):e.post("/user_login",i.data,function(e){e.code==200?r.hasClass("pop")?window.location.reload():window.location.href="/my":n.alert(e.message)},"json").fail(function(e){n.alert(e)})},bindLike:function(t){var r=t.data("userid"),i=t.data("goodsid");if(!r)return n.modal(e(".pop-login")),!1;e.post("/like","goods_id="+i,function(e){e.code==200?(t.toggleClass("like"),t.find("span").html(e.data)):n.alert(e.message)},"json").fail(function(e){n.alert(e)})},bindSlide:function(t){t.each(function(){var t=e(this).find(".slide-container"),n=e(this).find(".slide-item"),r=e(window).width(),i=0,s,o,u=0;for(var a=0;a<n.length;a++)i+=n.eq(a).width();t.width(Math.ceil(i));var f=e(this).children();f.on("touchstart",function(e){s=e.targetTouches[0].pageX}),f.on("touchmove",function(t){var n=t.targetTouches[0].pageX;o=n-s+u,o>0&&(o=0),o<r-i&&(o=r-i),e(this).css("transform","translate3d("+o+"px,0,0)")}),f.on("touchend",function(e){u=o})})},upload:function(t,n,r){var i=t.files;if(t.value&&i.length>0){if(i.length>20)return r&&r.tips("最多上传10张哦"),!1;var s=new FormData;for(var o=i.length-1;o>=0;o--){if(i[o].size/1024>5120||!/(png|PNG|jpg|JPG|jpeg|JPEG|gif|GIF)$/.test(i[o].type))return r&&r.tips("上传失败，可能是图片太大，只支持png/jpg/gif格式的图片哦"),!1;s.append("file"+o,i[o])}e.ajax({url:n,type:"POST",dataType:"json",beforeSend:r&&r.before,success:function(e){r&&r.success(e)},error:r&&r.tips,complete:r&&r.complete,data:s,cache:!1,contentType:!1,processData:!1})}var u=e("<div></div>");u.append(e(t).clone()),e(t).replaceWith(u.html()),u=null},bindEvent:function(){}};return r});