/*! mobile-select-area author:tianxiangbing email:55342775@qq.com
* demo:http://www.lovewebgames.com/jsmodule/mobile-select-area.html 
* git:https://github.com/tianxiangbing/mobile-select-area  2015-09-15 */

!function(e,t){"function"==typeof define&&define.amd?define(["zepto"],t):"object"==typeof exports?module.exports=t():e.Dialog=t(window.Zepto||window.jQuery||$)}(this,function(e){e.fn.Dialog=function(n){var r=[];return e(this).each(function(){var i=new t,s=e.extend({trigger:e(this)},n);i.init(s),r.push(i)}),r},e.Dialog=function(n){if("alert"===n.type){var r=new t,i='<div class="ui-alert-title">'+n.content+"</div>",s="";n.button?("boolean"==typeof n.button&&(n.button="确定"),s='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+n.button+"</button></p>"):n.timer||(n.timer=3e3),i+=s;var o=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(){this.dispose(),n.callback&&n.callback()}},n);r.init(o),n.timer&&setTimeout(function(){r.dispose(),n.callback&&n.callback()},n.timer),r.touch(r.mask,function(){r.dispose(),n.callback&&n.callback()})}if("confirm"===n.type){var u=new t,i='<div class="ui-confirm-title">'+n.content+"</div>",s="";n.buttons||(n.buttons=[{yes:"确定"},{no:"取消"}]);for(var f="",l=0,c=n.buttons.length;c>l;l++){var h=n.buttons[l];h.yes&&(f+='<td><button class="ui-confirm-submit " data-type="yes">'+h.yes+"</button></td>"),h.no&&(f+='<td><button class="ui-confirm-no" data-type="no">'+h.no+"</button></td>"),h.close&&(f+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+h.close+"</button></td>")}s='<table class="ui-dialog-action"><tr>'+f+"</tr></table>",i+=s;var p=e.extend({target:i,animate:!0,show:!0,mask:!0,className:"ui-alert",afterHide:function(){this.dispose()},beforeShow:function(t){u.touch(e(".ui-confirm-submit",t),function(){n.callback&&n.callback.call(u,"yes",t)}),u.touch(e(".ui-confirm-no",t),function(){n.callback&&n.callback.call(u,"no",t)}),u.touch(e(".ui-confirm-close",t),function(){n.callback&&n.callback.call(u,"close",t)})}},n);u.init(p)}},e.alert=function(t,n,r,i){e.Dialog({content:t,button:n,timer:i,callback:r,zIndex:100,type:"alert"})},e.confirm=function(t,n,r,i){e.Dialog(e.extend({content:t,buttons:n,callback:r,zIndex:100,type:"confirm"},i))};var t=function(){var t=Math.random().toString().replace(".","");this.id="dialog_"+t,this.settings={},this.settings.closeTpl=e('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=e('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=e()};return t.prototype={init:function(t){this.settings=e.extend({},this.settings,t),this.settings.mask&&(this.mask=e('<div class="ui-dialog-mask"/>'),e("body").append(this.mask)),e("body").append('<div class="ui-dialog" id="'+this.id+'"></div>'),this.dialogContainer=e("#"+this.id);var n=this.settings.zIndex||10;this.dialogContainer.css({zIndex:n}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:n-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(t,n){function r(e){return n.call(this,e)}var i;e(t).on("click",r),e(t).on("touchmove",function(){i=!0}).on("touchend",function(e){if(e.preventDefault(),!i){var t=n.call(this,e,"touch");t||(e.preventDefault(),e.stopPropagation())}i=!1})},bindEvent:function(){var t=this;this.settings.trigger&&(e(this.settings.trigger).click(function(){t.show()}),t.touch(e(this.settings.trigger),function(){t.show()})),e(this.dialogContainer).delegate(".js-dialog-close","click",function(){return t.hide(),!1}),e(window).resize(function(){t.setPosition()}),e(window).scroll(function(){t.setPosition()}),e(window).keydown(function(e){27===e.keyCode&&t.showed&&t.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var t=this;t.settings.beforeHide&&t.settings.beforeHide.call(t,t.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){t.dialogContainer.hide(),"object"==typeof t.settings.target&&e("body").append(t.dialogContainer.hide()),t.settings.afterHide&&t.settings.afterHide.call(t,t.dialogContainer)},500)):(this.dialogContainer.hide(),"object"==typeof this.settings.target&&e("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){this.dailogContent="string"==typeof this.settings.target?e(/^(\.|\#\w+)/gi.test(this.settings.target)?this.settings.target:"<div>"+this.settings.target+"</div>"):this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,e(this.settings.trigger).blur(),this.setPosition();var t=this;this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){t.setPosition()},1e3),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var e=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var t=this.settings.clientHeight||document.documentElement.clientHeight||document.body.clientHeight,n=this.settings.clientWidth||document.documentElement.clientWidth||document.body.clientWidth,r=this.width/2,i=this.height/2,s=n/2-r,o=t/2-i;s=Math.max(0,s),o=Math.max(0,o),e.dialogContainer.css({position:"fixed",top:o,left:s})}}},t});