define(["zepto","ui"],function(e,t){var n={getParams:function(t){var r=t.find(".J-param"),i={data:{},error:[]};return r.each(function(){var t=this.name,r=this.value,s=n.verify(t)(r);i.data[t]=r,s||(typeof s=="boolean"?i.error.push({element:e(this),error:e(this).data("verify")}):typeof s=="undefined"&&i.error.push({element:e(this),error:e(this).data("error")}))}),i},getCode:function(r,i,s){var o=n.verify(r[0].name)(r[0].value);if(o){if(n.timer)return!1;var u=60;i.text("发送验证码..."),e.post("/get_code","phone="+r.val()+"&code_type="+s,function(e){if(e.code!="200")return t.alert(e.message),i.text("重新发送"),!1;i.text("发送成功 ("+u+"s)"),n.timer=setInterval(function(){u>1?i.text("发送成功 ("+ --u+"s)"):(clearInterval(n.timer),i.text("重新发送"),n.timer=null)},1e3)},"json").fail(function(e){t.alert(e),i.text("重新发送")})}else typeof o=="boolean"?t.alert(r.data("verify")):typeof o=="undefined"&&t.alert(r.data("error"))},verify:function(e){var t={phone:["phone"],password:["passwd","pay_passwd"],repassword:["repassword"],verifycode:["verifycode"],zipcode:["zipcode"]};for(var n in t)if(t[n].indexOf(e)>-1)return this.filter[n];return this.filter.checknull},filter:{select:function(e){if(e!="")return!0},password:function(t){return t=e.trim(t),t==""?undefined:t.length<6||t.length>25?!1:(this.pwd=t,!0)},phone:function(t){return t=e.trim(t),t==""?undefined:/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/.test(t)?!0:!1},repassword:function(t){return t=e.trim(t),t==""?undefined:t!=this.pwd?!1:!0},verifycode:function(t){return t=e.trim(t),t==""?undefined:/^\d{6}$/.test(t)?!0:!1},zipcode:function(t){return t=e.trim(t),t==""?undefined:/^[0-9]{6}$/.test(t)?!0:!1},address:function(t){return t=e.trim(t),t==""?undefined:t.length<5||t.length>100?!1:!0},checknull:function(t){t=e.trim(t);if(t!="")return!0}}};return{init:n.getParams,getCode:n.getCode}});